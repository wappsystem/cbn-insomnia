<div id=D__ID>
	<!--third html start -->
		<div class="container mt-95 mb-3">
		  	<div class="row" >
			<!-- form container start -->
				<div class="col-12 col-lg-12 col-md-12 col-sm-12 mx-auto formbox">
			  		<div class="row">
						<div class="col-12">
				  		<!-- form start -->
				  		<form id="F__ID">
					  		<h3 id=title__ID></h3>
							<div id="participant_div__ID">
								<div class="form-group">
									<fieldset class="subquestions">
									<label><span class="">Participant</span>
										<input type=text name="Participant" class=form-control id=Participant__ID data-id="Participant" />
									</label><br>
									<label><span class="">Participant ID</span>
										<input type=text name="Participant_uid" class=form-control readonly />
									</label>
									</fieldset>
								</div>
							</div>
							<button type="submit" id="submit__ID" class="btn btn-primary btn-lg">Submit</button>
							<hr>
                            <!-- Form Inputs-------------------------------------->
                            <!-- Question and Answerset -->
							<div class="row px-4">
								<div class='col'>
								   <span>File</span>
								   <div class="form-control">
									   <u style='cursor:pointer' id=link_File_Name__ID></u>
									   <br>
									   <input type="file" name=File_Name style="margin-top:6px" /> &nbsp&nbsp&nbsp <button type="button" id=x_File_Name__ID>Remove</button>
								   </div>
                                   <div>
                                        Select which trial you want to upload:
                                        <select id="rowSelector" name="trial" class="form-control"></select>
                                        <br />
                                    </div>
                                </div>
                            </div>
							<hr>
							<div id=dynamic_part__ID></div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	VmInclude:__COMPONENT__/m/model.01.html

                <!-- Variable Inputs---------------------------------->
<!--                <div class='row row__ID'>
                    <div class='col'> <span>Last Name</span> <input type=text class=form-control name=Last_Name> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>First Name</span> <input type=text class=form-control name=First_Name>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Mid Name</span> <input type=text class=form-control name=Mid_Name> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Data File</span> <input type=text class=form-control name=Data_File> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Trial Type</span> <input type=text class=form-control name=Trial_Type>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Sub Type</span> <input type=text class=form-control name=Sub_Type> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>X Avg</span> <input type=text class=form-control name=X_Avg>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>X Max</span> <input type=text class=form-control name=X_Max>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>X Min</span> <input type=text class=form-control name=X_Min>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>X SD</span> <input type=text class=form-control name=X_SD>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>X Skew</span> <input type=text class=form-control name=X_Skew>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>X Krts</span> <input type=text class=form-control name=X_Krts>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>X D Avg</span> <input type=text class=form-control name=X_D_Avg>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Y Avg</span> <input type=text class=form-control name=Y_Avg>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Y Max</span> <input type=text class=form-control name=Y_Max>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Y Min</span> <input type=text class=form-control name=Y_Min>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Y SD</span> <input type=text class=form-control name=Y_SD>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Y Skew</span> <input type=text class=form-control name=Y_Skew>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Y Krts</span> <input type=text class=form-control name=Y_Krts>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Y D Avg</span> <input type=text class=form-control name=Y_D_Avg>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Rdl D Avg</span> <input type=text class=form-control name=Rdl_D_Avg> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Rdl D SD</span> <input type=text class=form-control name=Rdl_D_SD> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Area Circ</span> <input type=text class=form-control name=Area_Circ> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Area Rect</span> <input type=text class=form-control name=Area_Rect> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Area Efft</span> <input type=text class=form-control name=Area_Efft> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Path Lgth</span> <input type=text class=form-control name=Path_Lgth> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Unit Path</span> <input type=text class=form-control name=Unit_Path> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>PathArea</span> <input type=text class=form-control name=PathArea> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Vx Max</span> <input type=text class=form-control name=Vx_Max>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Vx Min</span> <input type=text class=form-control name=Vx_Min>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Vy Max</span> <input type=text class=form-control name=Vy_Max>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Vy Min</span> <input type=text class=form-control name=Vy_Min>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>V Avg</span> <input type=text class=form-control name=V_Avg>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>DCG X</span> <input type=text class=form-control name=DCG_X>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>DCG Y</span> <input type=text class=form-control name=DCG_Y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Cov</span> <input type=text class=form-control name=Cov> </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Area95</span> <input type=text class=form-control name=Area95>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Majr95</span> <input type=text class=form-control name=Majr95>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Minr95</span> <input type=text class=form-control name=Minr95>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Tan95</span> <input type=text class=form-control name=Tan95>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>Slope95</span> <input type=text class=form-control name=Slope95>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS0x</span> <input type=text class=form-control name=BOS0x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS0y</span> <input type=text class=form-control name=BOS0y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS1x</span> <input type=text class=form-control name=BOS1x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS1y</span> <input type=text class=form-control name=BOS1y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS2x</span> <input type=text class=form-control name=BOS2x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS2y</span> <input type=text class=form-control name=BOS2y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS3x</span> <input type=text class=form-control name=BOS3x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS3y</span> <input type=text class=form-control name=BOS3y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS4x</span> <input type=text class=form-control name=BOS4x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS4y</span> <input type=text class=form-control name=BOS4y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS5x</span> <input type=text class=form-control name=BOS5x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS5y</span> <input type=text class=form-control name=BOS5y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS6x</span> <input type=text class=form-control name=BOS6x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS6y</span> <input type=text class=form-control name=BOS6y>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS7x</span> <input type=text class=form-control name=BOS7x>
                    </div>
                </div>
                <div class='row row__ID'>
                    <div class='col'> <span>BOS7y</span> <input type=text class=form-control name=BOS7y>
                    </div>
                </div>
            </div>
        </form>
    </section>-->
    <script>
        function F__ID() {
            //-------------------------------------
            VmInclude: '__COMPONENT__/f/form.01.js'
            VmInclude: '__CURRENT_PATH__/shared-form.js'
            //-------------------------------------
            var load2=m.load;
			m.load=function(){
				load2();
				$('#title__ID').html($vm.module_list[$vm.vm['__ID'].name].task_name);
				
				var fs=$vm.dyn_fields.split(',');
				var txt="";
				var ic=0;
				for(ic=0;ic<fs.length;ic++){
					if(ic%4==0){
						txt+='<div class="row px-4">\r\n';
						//txt+='<div class="questiongroup ">\r\n';
						//txt+='<fieldset class="subquestions">\r\n';
					}
					txt+='<div class="col-sm-12 col-lg-3"><label> <span>'+fs[ic].replace(/_/g,' ')+'</span>\r\n';
					txt+='<input class="form-control" type="text" name="'+fs[ic]+'" >\r\n';
					txt+='</label></div>\r\n';
					if(ic%4==3){
						txt+='</div>\r\n';
					}
				}
				if(ic%4!=3){
					txt+='</div>\r\n';
				}
				$('#dynamic_part__ID').html(txt);
//				if(m.input.record!=undefined){
//					$('#record__ID').val(m.input.record.UID)
//				}
				if(m.input.readonly!=undefined) $('#submit__ID').hide();
				//render_file_field_v2(m.input.record,'__ID',$('#File_Name__ID'));
				m.set_file_link("File_Name");
			}
			//-------------------------------------
            var varNames;
            var varValues = Array();
            //-------------------------------------
            $('#F__ID input[name=File_Name]').on('change', function (evt) {
                if (this.files.length == 1) {
                    file_process(this.files[0])
                }
            });
            $('#rowSelector').on('change', function (evt) {
                var selectRow = $('#rowSelector').val() - 1;
                console.log('row changed:' + selectRow)
                console.log(varValues);
                // Store the value of each variable in the form-input field
                for (var v = 0; v < varNames.length; v++) {
                    $('#F__ID input[name="' + varNames[v] + '"]').val(varValues[selectRow][v]);
                }
            });

            function parseVariableName(str) {
                str = str.replace(/[^\w\s]/gi, ''); // String may not contain special characters
                str = str.trim(); // Trim any <space> characters from start or end of string
                str = str.replace(/^\d+\s*/, ''); // String cannot start with numbers
                str = str.split(' ').join('_'); // Join any remaining bits of string with underscores
                return str;
            }

            //-------------------------------------
            // File reader function
            var file_process = function (file) {
                // Create a new file reader and on loading a file -> run
                var reader = new FileReader();
                reader.onload = (function (e) {

                    ///////////////////////////////////////////////////////////////////////////////
                    // MANUAL EDIT REQUIRED HERE 
                    // Specify whether the variabels are listed as rows (false) or as columns (true)
                    // Specify the delimiter
                    var columnWise = true;
                    var delimiter = ',';
                    var startRow = 0;

                    // Get contents
                    var contents = e.target.result;
                    // Split the contents into rows based on the new-line character '\n'
                    var rows = contents.replace(/"/g, '').replace(/\r/, '\n').replace(/\n\n/, '\n').split('\n');
                    var optionsHTML = "<option value='na'>Select a row...</option>";
                    for (var r = startRow; r < rows.length - 1; r++) {
                        optionsHTML += "<option value='" + (r + 1 - startRow) + "'>" + (r + 1 - startRow) +
                            "</option>";
                    }
                    $('#rowSelector').html(optionsHTML);

                    // Extract the data
                    if (columnWise) { // Column-wise
                        for (var r = startRow; r < rows.length; r++) {
                            // The first row contains all variable names
                            if (r == startRow) {
                                varNames = rows[r].split(delimiter);
                                // Replace any <space> or other special character
                                for (v = 0; v < varNames.length; v++) {
                                    varNames[v] = parseVariableName(varNames[v]);
                                }
                            } else {
                                // The subsequent rows contains the values
                                varValues[r - 1 - startRow] = rows[r].split(delimiter);
                            }
                        }
                    } else { // Row-wise
                        // Initialize the varNames and varValue arrays
                        varNames = Array();
                        varValues = Array();
                        // For each row, extract the variable name and value, and store in the form-input field.
                        for (var r = 0; r < rows.length; r++) {
                            // Split the variable name and value pair based on the delimiter
                            var row = rows[r].split(delimiter);
                            varNames[r] = parseVariableName(varNames[r]);
                            varValues[r] = row[1];
                            // Store the value of each variable in the form-input field
                            $('#F__ID input[name="' + varNames[r] + '"]').val(varValues[r]);
                        }
                    }
                    console.log(varNames.join());
                });
                reader.readAsText(file);
            }
        }
      //------------------------------------
    </script>
    <style>
        VmInclude:__CURRENT_PATH__/wappsystem-form.css
    </style>
</div>